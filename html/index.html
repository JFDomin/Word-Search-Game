<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Search Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<label id="topMessage"></label>
<body>
<div id = "page1">
    <div id="table-container"style="display: flex;width: 100%";> </div>
    <div style="display: flex;width: 100%;"id="table-container"></div>
<h1 style="text-align: center">Word Search Game</h1>

<div style="display:flex;">
    <div style="display:flex;flex-direction:column;width:20%"id = "Lobby">
        <div>Lobby</div>
        <label for="input-data">Enter nickname:</label>
        <input type="text" id="input-data" placeholder="Enter nickname" onchange="handleChange(event)">
        <button onclick="handleNickEnter()">Join</button>
        <span id="error"></span>
    </div>


    <div style="display:flex;flex-direction:column;width:80%;border: 1px solid black;padding: 20px;margin-left: 5px;justify-content: center;"id = "WaitingPlayers">
        <div id="waiting-text">Waiting for Players...</div>
        <div style="display:flex;width: 80%;justify-content: space-around;" id="playerContainer">
        </div>
        <div style="display: flex;width: 30%;justify-content: space-between;padding: 0 5px;margin: 0 auto;">
            <button id="ready-btn" style="width: auto;"onclick="readyPlayer()" disabled>Ready Up</button>
            <button id="start-btn" style="width: auto;"onclick="startGame()" disabled>Start Game</button>
            
        </div>
    </div>
</div>
</div>
<div id= "page2" style = "display: none;">


</div>

<script>
     class UserEvent {
     GameId; // the game ID on the server
     PlayerIdx; // either PLAYER1 PLAYER2 PLYAER 3 or PLAYER4
     button; //what button they pressed 
     nickname; //the nickname entered if it is join button
     ready;
}
    let nickname = "";
    let error = document.getElementById("error");

    function handleMissingNickname(){
        console.log("player missing nickname")
        error.textContent = "Please enter a nickname."
        error.style.color = "red"
        return
    }
    function handleChange(event) {
  // Get the input field value
    // var inputData = event.target.value;
    // nickname = event.target.value;
  // Log the changed data
    // nickname = inputData;
    }
    function handleNickEnter(){
        const nickname = document.getElementById("input-data").value
        const readyButton = document.getElementById("ready-btn");
        const startButton = document.getElementById("start-btn");
        console.log('nickname', nickname)
        if (!nickname) {
            handleMissingNickname();
        }
        else {
            U = new UserEvent;
            buttonType = "join";
            U.nickname = nickname;
            U.button = buttonType;
            connection.send(JSON.stringify(U));
            console.log(JSON.stringify(U));
            const playerContainer = document.getElementById("playerContainer");
            const playerDiv = document.createElement("div");
            playerDiv.className = "player";
            playerDiv.textContent = nickname;
            playerContainer.appendChild(playerDiv);


            const playerIndex = players.length + 1;
            const playerColor = playerColors["PLAYER" + playerIndex];
            playerDiv.style.backgroundColor = playerColor;

            // Update the text if there are multiple players
            if (playerContainer.children.length === 1) {
                const waitingText = document.getElementById("waiting-text");
                waitingText.textContent = "Waiting for another player...";
            }
            if (playerContainer.children.length > 1) {
                const waitingText = document.getElementById("waiting-text");
                waitingText.textContent = "Waiting for Players to ready up";
            }

            error.textContent = ""
            console.log("player joined: ", nickname);
            readyButton.disabled = false;
            startButton.disabled = false;
        }

    }
    function readyPlayer(){
        const nickname = document.getElementById("input-data").value
        // logic is not complete yet
        if (!nickname) {
            handleMissingNickname();
        }
        else {
            buttonType = "readyUp";
            U.button = buttonType;
            connection.send(JSON.stringify(U));
            console.log(JSON.stringify(U));
            error.textContent = ""
            console.log("player ready: ", nickname);
        }

    }
    function startGame(){
        const nickname = document.getElementById("input-data").value;
        if (!nickname) {
            handleMissingNickname();
        }
        else {
            console.log("game started by: ", nickname);
            buttonType = "startGame";
            U.button = buttonType;
            connection.send(JSON.stringify(U));
            console.log(JSON.stringify(U));
            // implement logic for number of players somewhere in java
        }
    }
</script>
</body>
<div id = "WaitingPlayers"></div>
<script src="uidisplay.js"></script>

<script>
    var connection = null;
    var serverUrl = "ws://" + window.location.hostname +":"+ (parseInt(location.port) + 100);
    document.getElementById("topMessage").innerHTML = "?";
    // Create the connection with the server
    connection = new WebSocket(serverUrl);

    connection.onopen = function (evt) {
        console.log("open - Connection established");
        document.getElementById("topMessage").innerHTML = " "

    }
    connection.onclose = function (evt) {
        console.log("close");
        document.getElementById("topMessage").innerHTML = "Server Offline"
    }
    connection.onmessage = function (evt) {
        var msg;
        msg = evt.data;
        console.log("Message received: " + msg);
        const obj = JSON.parse(msg);
        if (obj.type == "wordGrid"){
            console.log(obj.data);
            //displayGrid(obj.data);
            const tableContainer = document.getElementById('table-container');
            tableContainer.innerHTML = displayGrid(obj.data);
        }
        if('YouAre' in obj){
            if(obj.YouAre == "PLAYER1"){
                idx = 0;
                setPlayerColor(playerColor);
            }
            else if (obj.YouAre == "PLAYER2"){
                idx = 2;
            }
            else if(obj.YouAre == "PLAYER3"){
                idx = 3;
            }
            console.log(msg);
        }
        //console.log(obj.data);
    };
    //console.log("Message received: " + msg);

    </script>
    <link rel="stylesheet" href="style.css">
    </body>
    </html>